#!/usr/bin/env bash

set -e

readonly DCP="${HOME}/.dcp"
readonly ENVRC_PATH="${DCP}/envrc"
readonly CONFIG_PATH="${DCP}/conf/vars"

if [[ "$(uname -s)" != "Darwin" ]]; then
  exit 1
fi

if [[ ! -e "${ENVRC_PATH}" || ! -e "${CONFIG_PATH}" ]]; then
  exit 1
fi

. "${ENVRC_PATH}"

while read -r var_name; do
  launchctl setenv "${var_name}" "${!var_name}" || true
done < <(cat "${CONFIG_PATH}")
