#
# Add oh-my-zsh plugins
#

# Standard plugins
plugins=(history jsontools zsh-syntax-highlighting)

# Emoji probably don't matter in non-256color environments
if [[ " ${TERM} " = *256color* ]]; then
  plugins+=(emoji)
fi

# Mac-specific plugins
if [[ "${DCP_OS}" = "Darwin" ]]; then
  plugins+=(brew-cask osx)
fi

# User-specified plugins

if [[ -s "${DCP}/conf/plugins" ]]; then
  printf >&2 "DCP: The 'conf' directory is deprecated and will be removed soon.\n"
  printf >&2 "Moving %s => %s\n" \
             "${DCP}/conf/plugins" \
             "${DCP_CONFIG_DIR}/plugins.lst"

  mv "${DCP}/conf/plugins" "${DCP_CONFIG_DIR}/plugins.lst"
fi

if [[ -s "${DCP_CONFIG_DIR}/plugins.lst" ]]; then
  while IFS='' read -r plugin; do
    plugins+=("${plugin}")
  done < <(cat "${DCP_CONFIG_DIR}/plugins.lst")
  unset plugin
fi

# Load most of dcp
. "${DCP}/lib/init.sh"

# Load oh-my-zsh
. "${ZSH}/oh-my-zsh.sh"

# Completion aliasing for GitHub CLI

if __is_command hub; then
  alias git="hub"

  if type compdef > /dev/null; then
     compdef hub=git
  fi
fi

# Enable fallback behavior when glob matching fails
unsetopt nomatch

# Finish up the details
. "${DCP}/lib/post_init.sh"
