#
# Add oh-my-zsh plugins
#

# Standard plugins
plugins=( history jsontools zsh-syntax-highlighting )

# Emoji probably don't matter in non-256color environments
if [[ "${TERM}" = *256color* ]]; then
  plugins+=( emoji )
fi

# Mac-specific plugins
if [[ "${DCP_OS}" = "Darwin" ]]; then
  plugins+=( brew-cask osx )
fi

# User-specified plugins
if [[ -s "${DCP}/conf/plugins" ]]; then
  while read -r plugin; do
    plugins+=( "${plugin}" )
  done < <(cat "${DCP}/conf/plugins")

  unset plugin
fi


#
# Load all the things!
#

# Load most of dcp
if [[ -e "${DCP}/lib/init.sh" ]]; then
  . "${DCP}/lib/init.sh"
fi

# Load oh-my-zsh
if [[ -e "${ZSH}/oh-my-zsh.sh" ]]; then
  . "${ZSH}/oh-my-zsh.sh"
fi

# Completion aliasing for GitHub CLI
if hash hub 2> /dev/null; then
  alias git="hub"

  if type compdef > /dev/null; then
     compdef hub=git
  fi
fi

# Finish up the details
if [[ -e "${DCP}/lib/post_init.sh" ]]; then
  . "${DCP}/lib/post_init.sh"
fi

# Enable fallback behavior when glob matching fails
unsetopt nomatch
